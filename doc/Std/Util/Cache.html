<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="stylesheet" href="../.././src/pygments.css"></link><link rel="shortcut icon" href="../.././favicon.ico"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Std.Util.Cache</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Std.Util.Cache";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Std</span>.<span class="name">Util</span>.<span class="name">Cache</span></h2><form action="https://google.com/search" method="get" id="search_form"><input type="hidden" name="sitesearch" value="https://leanprover-community.github.io/mathlib4_docs"></input><input type="text" name="q" autocomplete="off"></input>&#32;
            <button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button><button>Google site search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init.html">Init</a></li><li><a href="../.././Std/Lean/Meta/DiscrTree.html">Std.Lean.Meta.DiscrTree</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Std.Util.Cache" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.Cache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.instNonemptyCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">instNonemptyCache</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.Cache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span>.<span class="name">mk</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.Cache.get"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span>.<span class="name">get</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DeclCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.instNonemptyDeclCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">instNonemptyDeclCache</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DeclCache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span>.<span class="name">mk</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DeclCache.get"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span>.<span class="name">get</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DiscrTreeCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DiscrTreeCache.config"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">config</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DiscrTreeCache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">mk</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Tactic.DiscrTreeCache.getMatch"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">getMatch</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="Once-per-file-cache-for-tactics">Once-per-file cache for tactics <a class="hover-link" href="#Once-per-file-cache-for-tactics">#</a></h1><p>This file defines cache data structures for tactics
that are initialized the first time they are accessed.
Since Lean 4 starts one process per file, these caches are once-per-file
and can for example be used to cache information about the imported modules.</p><p>The <code><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Cache</a> α</code> data structure is the most generic version we define.
It is created using <code><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.mk">Cache.mk</a> f</code> where <code>f : MetaM α</code> performs the initialization of the cache:</p><pre><code>initialize numberOfImports : <a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Cache</a> <a href="../.././Init/Prelude.html#Nat">Nat</a> ← <a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.mk">Cache.mk</a> do
  (← getEnv).imports.size

-- (does <a href="../.././Init/Prelude.html#not">not</a> work in the same module where the <a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.cache">cache</a> is defined)
#eval show MetaM <a href="../.././Init/Prelude.html#Nat">Nat</a> from numberOfImports.<a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.get">get</a>
</code></pre><p>The <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">DeclCache</a> α</code> data structure computes a fold over the environment's constants:
<code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.mk">DeclCache.mk</a> empty f</code> constructs such a cache
where <code>empty : α</code> and <code>f : Name → ConstantInfo → α → MetaM α</code>.
The result of the constants in the imports is cached between tactic invocations,
while for constants defined in the same file <code>f</code> is evaluated again every time.
This kind of cache can be used e.g. to populate discrimination trees.</p></div><div class="decl" id="Std.Tactic.Cache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L39-L39">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.Cache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Once-per-file cache.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<span class="fn"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span> <a href="../.././Init/Core.html#Sum">⊕</a> <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Exception.html#Lean.Exception">Lean.Exception</a> <span class="fn">α</span></span>)</span></span></span>)</span></span></span></li></ul></details><details id="instances-for-list-Std.Tactic.Cache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.instNonemptyCache"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L44-L44">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.instNonemptyCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">instNonemptyCache</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">(_ : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span>)</span></span>)</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">(_ : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<span class="fn"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span> <a href="../.././Init/Core.html#Sum">⊕</a> <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Exception.html#Lean.Exception">Lean.Exception</a> <span class="fn">α</span></span>)</span></span></span>)</span></span>)</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Std.Tactic.Cache.mk"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L47-L47">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.Cache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span>.<span class="name">mk</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(init : <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span>)</span></span></div></div><p>Creates a cache with an initialization function.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.mk">Std.Tactic.Cache.mk</a> <span class="fn">init</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn"><a href="../.././Init/System/IO.html#IO.mkRef">IO.mkRef</a> <span class="fn">(<span class="fn"><a href="../.././Init/Core.html#Sum.inl">Sum.inl</a> <span class="fn">init</span></span>)</span></span>)</span></span></span></li></ul></details><details id="instances-for-list-Std.Tactic.Cache.mk" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.Cache.get"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L53-L73">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.Cache.get"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">Cache</span>.<span class="name">get</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{m : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Environment.html#Lean.MonadEnv">Lean.MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Log.html#Lean.MonadLog">Lean.MonadLog</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Options.html#Lean.MonadOptions">Lean.MonadOptions</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadLiftT">MonadLiftT</a> <a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#MonadExcept">MonadExcept</a> <a href="../.././Lean/Exception.html#Lean.Exception">Lean.Exception</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(cache : <span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><p>Access the cache. Calling this function for the first time will initialize the cache
with the function provided in the constructor.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Tactic.Cache.get" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DeclCache"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L79-L87">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Cached fold over the environment's declarations,
where a given function is applied to <code>α</code> for every constant.</p><ul class="structure_ext"><li id="Std.Tactic.DeclCache.mk'" class="structure_ext_ctor">mk' :: (</li><ul class="structure_ext_fields"><li id="Std.Tactic.DeclCache.cache" class="structure_field"><div class="structure_field_info">cache : <span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache">Std.Tactic.Cache</a> <span class="fn">α</span></span></div><div class="structure_field_doc"><p>The cached data.</p></div></li><li id="Std.Tactic.DeclCache.addDecl" class="structure_field"><div class="structure_field_info">addDecl : <span class="fn"><a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href="../.././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a> → <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span></span></span></div><div class="structure_field_doc"><p>Function for adding a declaration from the current file to the cache.</p></div></li><li id="Std.Tactic.DeclCache.addLibraryDecl" class="structure_field"><div class="structure_field_info">addLibraryDecl : <span class="fn"><a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href="../.././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a> → <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span></span></span></div><div class="structure_field_doc"><p>Function for adding a declaration from the library to the cache.
Defaults to the same behaviour as adding a declaration from the current file.</p></div></li></ul><li class="structure_ext_ctor">)</li></ul><details id="instances-for-list-Std.Tactic.DeclCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.instNonemptyDeclCache"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L87-L87">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.instNonemptyDeclCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">instNonemptyDeclCache</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">∀ {<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>} [<span class="fn">inst</span> : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">α</span></span>], <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">α</span></span>)</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">(_ : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">α</span></span>)</span></span>)</span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">(_ : <span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">α</span></span>)</span></span>)</span></span></li></ul></details></div></div><div class="decl" id="Std.Tactic.DeclCache.mk"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L103-L118">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span>.<span class="name">mk</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(profilingName : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(pre : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span>)</span> <span class="fn">failure</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(empty : <span class="fn">α</span>)</span></span>
<span class="decl_args">
<span class="fn">(addDecl : <span class="fn"><a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href="../.././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a> → <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(addLibraryDecl : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href="../.././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a> → <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span></span></span>)</span> <span class="fn">addDecl</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(post : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></span>)</span> <span class="fn">fun (<span class="fn">a</span> : <span class="fn">α</span>) =&gt; <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">a</span></span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">α</span></span>)</span></span></div></div><p>Creates a <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">DeclCache</a></code>.</p><p>First, if <code>pre</code> is nonempty, run that for a value,
and if successful populate the cache with that value.</p><p>If <code>pre</code> is empty, or it fails,
the cached structure <code>α</code> is initialized with <code>empty</code>,
and then <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.addLibraryDecl">addLibraryDecl</a></code> is called for every imported constant.
After all imported constants have been added, we run <code>post</code>.
Finally, the result is cached.</p><p>When <code><a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.get">get</a></code> is called, <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.addDecl">addDecl</a></code> is also called for every constant in the current file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Tactic.DeclCache.mk" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DeclCache.get"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L124-L126">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache.get"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DeclCache</span>.<span class="name">get</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(cache : <span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">α</span></span></div></div><p>Access the cache. Calling this function for the first time will initialize the cache
with the function provided in the constructor.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Tactic.DeclCache.get" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DiscrTreeCache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L133-L133">source</a></div><div class="attributes">@[reducible]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span></a></span><span class="decl_args">
<span class="fn">(α : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>A type synonym for a <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">DeclCache</a></code> containing a pair of discrimination trees.
The first will store declarations in the current file,
the second will store declarations from imports (and will hopefully be "read-only" after creation).</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache">Std.Tactic.DiscrTreeCache</a> <span class="fn">α</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DeclCache">Std.Tactic.DeclCache</a> <span class="fn">(<span class="fn"><span class="fn"><a href="../.././Lean/Meta/DiscrTreeTypes.html#Lean.Meta.DiscrTree">Lean.Meta.DiscrTree</a> <span class="fn">α</span></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Lean/Meta/DiscrTreeTypes.html#Lean.Meta.DiscrTree">Lean.Meta.DiscrTree</a> <span class="fn">α</span></span></span>)</span></span></span></li></ul></details><details id="instances-for-list-Std.Tactic.DiscrTreeCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DiscrTreeCache.config"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L136-L136">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache.config"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">config</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Meta/WHNF.html#Lean.Meta.WhnfCoreConfig">Lean.Meta.WhnfCoreConfig</a></div></div><p>Discrimation tree settings for the <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache">DiscrTreeCache</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache.config">Std.Tactic.DiscrTreeCache.config</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn">{ <span class="fn">iota</span> := <a href="../.././Init/Prelude.html#Bool.true">true</a>, <span class="fn">beta</span> := <a href="../.././Init/Prelude.html#Bool.true">true</a>, <span class="fn">proj</span> := <a href="../.././Lean/Meta/WHNF.html#Lean.Meta.ProjReductionKind.yesWithDelta">Lean.Meta.ProjReductionKind.yesWithDelta</a>, <span class="fn">zeta</span> := <a href="../.././Init/Prelude.html#Bool.true">true</a> }</span></span></li></ul></details><details id="instances-for-list-Std.Tactic.DiscrTreeCache.config" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DiscrTreeCache.mk"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L142-L158">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache.mk"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">mk</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#BEq">BEq</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(profilingName : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(processDecl : <span class="fn"><a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a> → <span class="fn"><a href="../.././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a> → <span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Meta/DiscrTreeTypes.html#Lean.Meta.DiscrTree.Key">Lean.Meta.DiscrTree.Key</a></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn">α</span></span>)</span></span>)</span></span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(post? : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span> → <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span>)</span></span>)</span> <span class="fn">none</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(init : <span class="fn"><a href="../.././Init/Prelude.html#optParam">optParam</a> <span class="fn">(<span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<span class="fn"><a href="../.././Lean/Meta/DiscrTreeTypes.html#Lean.Meta.DiscrTree">Lean.Meta.DiscrTree</a> <span class="fn">α</span></span>)</span></span>)</span> <span class="fn">failure</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache">Std.Tactic.DiscrTreeCache</a> <span class="fn">α</span></span>)</span></span></div></div><p>Build a <code><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache">DiscrTreeCache</a></code>,
from a function that returns a collection of keys and values for each declaration.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Tactic.DiscrTreeCache.mk" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Tactic.DiscrTreeCache.getMatch"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/std4/blob/0d0ac1c43e1ec1965e0806af9e7a32999ea31096/Std/Util/Cache.lean#L169-L173">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache.getMatch"><span class="name">Std</span>.<span class="name">Tactic</span>.<span class="name">DiscrTreeCache</span>.<span class="name">getMatch</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{α : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(c : <span class="fn"><a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache">Std.Tactic.DiscrTreeCache</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(e : <a href="../.././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">Lean.MetaM</a> <span class="fn">(<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>)</span></span></div></div><p>Get matches from both the discrimination tree for declarations in the current file,
and for the imports.</p><p>Note that if you are calling this multiple times with the same environment,
it will rebuild the discrimination tree for the current file multiple times,
and it would be more efficient to call <code>c.<a href="../.././Std/Util/Cache.html#Std.Tactic.Cache.get">get</a></code> once,
and then call <code>DiscrTree.<a href="../.././Std/Util/Cache.html#Std.Tactic.DiscrTreeCache.getMatch">getMatch</a></code> multiple times.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Tactic.DiscrTreeCache.getMatch" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>